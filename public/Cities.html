<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Master Panel</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script> -->
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>


<link rel="stylesheet" type="text/css" href="CssPage1.css">
    <!-- <script type="module" src="Script3/CitiesScript.js"></script> -->
    <script type = "text/javascript" src="jQuery.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round|Open+Sans">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />





<link href=
"https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
         rel="stylesheet">
         <!-- <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"> -->

<!-- <script src="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css"></script> -->
<!-- <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
<script src="src/fancyTable.js"></script>

<script type="text/javascript" src="/public/pagesort.js"></script>


<link href="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.css" rel="stylesheet">
<script src="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.js"></script>
<script src="https://cdn.jsdelivr.net/n pm/jquery.fancytable/dist/fancyTable.min.js"></script>
<script src="src/fancyTable.js"></script>

  </head>
  <body style="color: white !important;">
    <!-- code for the master page -->
    <div id="wrapper" class="toggled">
      <div id="sidebar-wrapper">
        <div class="logo">
          <img src="logoimage.png" class="logoimg" alt="">
        </div>
          <ul class="sidebar-nav">
             <li>
                <button style="text-align: left; background-color:transparent;border: none; color: white;" onclick="location.href = 'Certification.html'" id="defaultOpen">Certification</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none; margin-top: 20px; color: white;"  onclick="location.href = 'JobTypes.html'" id="defaultOpen">JobTypes</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'Qualification.html'" id="defaultOpen2">Qualification</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'Skills.html'" id="defaultOpen3">Skills</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'FunctionalArea.html'" id="defaultOpen4">Functional Area</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'Cities.html'" id="defaultOpen5">Cities</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'Specialization.html'" id="defaultOpen6">Specialization</button>
              </li>
              <li>
                <button class="dropbtn" style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'BlogMaster.html'" id="defaultOpen7">Blog Master</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'PackageMaster.html'" id="defaultOpen8">Package Master</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'CouponMaster.html'" id="defaultOpen8">Coupon Master</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'EmployerMaster.html'" id="defaultOpen8">Employer Master</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'CandidateMaster.html'" id="defaultOpen8">Candidate Master</button>
              </li>
              <li>
                <button style="text-align: left; background-color:transparent;border: none;color: white;margin-top: 20px;" onclick="location.href = 'ChangePassword.html'" id="defaultOpen9">Change Password</button>
              </li>

          </ul>
      </div>



  <!-- cities-->
  <div id="cities" class="tabcontent">
    <a href="#menu-toggle5" style="background-color: #454d55;"  class="tgl-btn" id="menu-toggle5"><i style="color: white; border-top-left-radius:0px" class="fa fa-bars"></i></a>
    <button type="button" style="color: white;" class="btn add-btn" onclick="Logoutfunc()"><i class="fa fa-power-off"></i></button>
    <div id="page-content-wrapper">
        <div class="m-1">
          <h1>Cities</h1>
          <button style="float: right;color:white;" type="button" class="btn add-btn" onclick="openForm()"><i class="fa fa-plus"></i> Add New</button>
        </div>
        <div class="row">
          <div class="inline-block">
              <input type="text" name="searchCityName" id="searchCityName" placeholder="Enter City Name">
              <input type="text" name="searchStateName" id="searchStateName" placeholder="Enter State Name">
              <button type="submit" id="subbut" class="sub-btn" style="margin-left: 10px;" onclick="stateSearchFunctionSubmit()">Submit</button>
              <input id="cancelButton" style="background-color: white; color:black; margin-left: 10px;" class="sub-btn" onClick="location.href='Cities.html'" type="button" value="Clear">
            </div>
      </div>
      <table id="myTableCiti" class="table myTableCiti" style="column-width: 1px;">
      <thead>
        <tr style="color: white;">
          <th>City </th>
          <th>State</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="tbody5" style=" color:white">
      </tbody>
    </table>
    </div>
    <dialog id="favDialog" style="position:absolute; bottom: auto; width: fit-content; height: fit-content;">
      <form method="dialog">
        <div>
          <label>Enter City Name:</label>
          <input class="input-box-330" type="text" name="cityName" id="cityName" required>
        </div>
        <div>
          <label>Enter State Name:</label>
          <input class="input-box-330" type="text" name="stateName" id="stateName" required>
        </div> 
        <input type="hidden" id="id" name="id"> 
        <div style="align-items: right;">
          <button type="submit" id="subbut" class="sub-btn" onclick="myFunctionCiti()" >Submit</button>
          <input id="cancelButton" style="background-color: white; color:black; margin-left: 10px;" class="sub-btn" onClick="closeForm()" type="button" value="Cancel">
        </div>
      </form>    
      </dialog>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/jquery.fancytable/dist/fancyTable.min.js"></script> 
<script>
$( window ).on("load", function() {
    setTimeout(async function(){
  $(".myTableCiti").fancyTable({
    sortable: true,
    pagination: true,
      globalSearch: true,
    perPage:5,
  });
}, 1000);
});

function openForm() {
  document.querySelector("#favDialog").showModal();
}

function closeForm() {
  document.querySelector("#favDialog").close();
  location.reload(true);
}

document.querySelector("#favDialog").addEventListener('cancel', function(e) {
	e.preventDefault();
});

</script>



  <script type="module">
  // import EditorJS from '@editorjs/editorjs';
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-analytics.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
    import { doc, deleteDoc,setDoc, getDoc, getDocs, collection,addDoc, query, limit, orderBy, where,updateDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyAADC0o-0zy-R8WWzSY4hq_ckhLzNv6CHM",
  authDomain: "hobyjoby-8b9ca.firebaseapp.com",
  projectId: "hobyjoby-8b9ca",
  storageBucket: "hobyjoby-8b9ca.appspot.com",
  messagingSenderId: "755782612092",
  appId: "1:755782612092:web:98ed2fb25735eb435985f9",
  measurementId: "G-L23JY97GH8"
};

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      var dateTime = new Date().toLocaleString().replace(',','');



  window.myFunctionCiti = async function() {
    var table = document.getElementById("myTableCiti");
    var cityName = document.getElementById("cityName").value;
    var stateName = document.getElementById("stateName").value;
    var dbID = document.getElementById("id").value;
    var a=table.rows.length;
    var b=table.rows.length;
    var ao;
    const snapshot =  await getDocs(collection(db, "JobConfig", "Master", "Cities"));
    if(!snapshot.empty)
    {
      const ids = snapshot.docs.map(doc => (!isNaN(parseInt((doc.id) ? doc.id : '0'))) ? parseInt((doc.id) ? doc.id : '0') : 0)
      const max = Math.max(...ids);
      ao = parseInt(max) + 1;
    }
    if(ao == null)
    {
      ao =1;
    }
    let text;
   if (cityName == null || cityName == "" || stateName == null || stateName == "" ) {
        text = "User cancelled the prompt.";
    } else {
      if(dbID == null || dbID == ""){
          await setDoc(doc(db, "JobConfig", "Master", "Cities",ao.toString()), {
                City: cityName.toString(),
                State:stateName.toString(),
                id : ao.toString()
                })
                .then(()=> {
                  setTimeout("location.reload(true);",120);
                })
                .catch((error)=>{
                    console.log(error);
                });
          }
          else{
            updateDoc(doc(db, "JobConfig", "Master", "Cities", dbID.toString()), {
                City: cityName.toString(),
                State:stateName.toString(),
                id : dbID.toString()
                })
                .then(()=> {  
                  setTimeout("location.reload(true);",120);
                })     
                .catch((error)=>{
                    console.log(error);
                }); 
          }
    }
  }

  window.stateSearchFunctionSubmit = function(){
    var state = document.getElementById("searchStateName").value;
    var city = document.getElementById("searchCityName").value; 

    if((city != null && city != '') && (state != null && state != '')){
      location.href = 'Cities.html?City=' + city + '&State=' + state;
    }
    else if(state != null && state != ''){
      location.href = 'Cities.html?State=' + state;
    }
    else if(city != null && city != ''){
      location.href = 'Cities.html?City=' + city;
    }
    else{
      alert("Select at least one value");
    }
  }

  window.Logoutfunc = function(){
    if (confirm("Are you sure you want to log out?") == true) {
      window.location.replace("index.html");

    } else {
        window.location.reload();
    }
   
  }

  var queryString = window.location.search.substring(1);
  var varArray = queryString.split("=").toString().split("&").toString().split(","); //eg. index.html?msg=1
  var paramType = varArray[0];
  var paramValue = varArray[1];
  var paramType2 = varArray[2];
  var paramValue2 = varArray[3];
 

  var tbody= document.getElementById("tbody5");

  function AddItemToTable4(cat,cby,uat){
      let trow=document.createElement("tr");
      //let td1=document.createElement("td");
      let td2=document.createElement("td");
      let td3=document.createElement("td");
      let td4=document.createElement("td");

      let btnc=document.createElement("button");
      btnc.setAttribute("id", "delc");
      btnc.setAttribute("class", "dg");
      btnc.innerHTML = '<i class="fa fa-trash-o"></i>';
      td4.appendChild(btnc);


      let btn2c = document.createElement("button");
      btn2c.setAttribute("id", "editc");
      btn2c.setAttribute("class", "bgr");
      btn2c.innerHTML = '<i class="fas fa-edit"></i>';
      td4.appendChild(btn2c);

      // let btn3c = document.createElement("button");
      // btn3c.setAttribute("id", "Savec");
      // btn3c.setAttribute("class", "bgds");
      // btn3c.innerHTML = '<i class="fa fa-save"></i>';
      // td4.appendChild(btn3c);

     // td1.innerHTML= cat;
      td2.innerHTML=cby;
      td3.innerHTML=uat;


      $(document).ready(function() {
        $("#delc").css("background-color", "red");
        $("#delc").css("color", "white");
        $("#delc").css("border-color", "white");

        $(".dg").css("background-color", "red");
        $(".dg").css("color", "white");
        $(".dg").css("border-color", "white");
      });
      $(document).ready(function() {
        $("#editc").css("background-color", "red");
        $("#editc").css("color", "white");
        $("#editc").css("border-color", "white");

        $(".bgr").css("background-color", "red");
        $(".bgr").css("color", "white");
        $(".bgr").css("border-color", "white");
      });
    //   $(document).ready(function() {
    //     $("#Savec").css("background-color", "red");
    //     $("#Savec").css("color", "white");
    //     $("#Savec").css("border-color", "white");

    //     $(".bgds").css("background-color", "red");
    //     $(".bgds").css("color", "white");
    //     $(".bgds").css("border-color", "white");
    // });
      //trow.appendChild(td1);
      trow.appendChild(td2);
      trow.appendChild(td3);
      trow.appendChild(td4);
      var num = String(cat);

      btnc.onclick = function () {
        var result = confirm("Are you sure you want to Delete City?");
        if (result) {
        deleteDoc(doc(db, "JobConfig", "Master","Cities",num))
        .then(()=> {  
          setTimeout("location.reload(true);",120);
        }) 
        }
      };

      btn2c.onclick = function () {
        
      document.getElementById("id").value = num;
      document.getElementById("cityName").value = cby;
      document.getElementById("stateName").value = uat;
      document.querySelector("#favDialog").showModal();




        // td3.contentEditable = true;
        // td2.contentEditable = true;
        // td3.style.backgroundColor = "#BBC4CE";
        // td2.style.backgroundColor = "#BBC4CE";
      }; 
      
      // btn3c.onclick = function () {
      //   td3.contentEditable = false;
      //   td2.contentEditable = false;
      //   var tio = String(cat);
      //   setDoc(doc(db, "JobConfig", "Master", "Cities", tio), {
      //     City: td2.innerHTML,
      //     State:td3.innerHTML,
      //     id : String(cat),
      //   });
      //   setTimeout("location.reload(true);",3000);
      // }; 
      tbody.appendChild(trow);
      // getMarkers();
      // timeFunction1();
  }

  function AddAllItemsToTable4(qualification){
      tbody.innerHTML="";

      qualification.forEach((element) => {
      AddItemToTable4(element.id,element.City,element.State);    
      });
  }

  

  if(paramType == 'City' && paramType2 == 'State'){
    document.getElementById('searchCityName').value = paramValue.toString();
    document.getElementById('searchStateName').value = paramValue2.toString();
  }
 if(paramType == 'City'){
   document.getElementById('searchCityName').value = paramValue.toString();
  }
 if(paramType == 'State' && paramValue != 'Maharashtra'){
      document.getElementById('searchStateName').value = paramValue.toString();
   }

   if(paramValue == null){
    paramValue="Maharashtra";
    paramType="State";
  }
var cert=[];
var id=[];
var q11;
if(paramValue2 != null){
  q11 =  query(collection(db, "JobConfig", "Master", "Cities"),where(paramType.toString(), "==",paramValue.toString()),where(paramType2.toString(),"==",paramValue2.toString()));
}
else{
  q11 =  query(collection(db, "JobConfig", "Master", "Cities"),where(paramType.toString(), "==",paramValue.toString()));
}
var querySnapshot11 = await getDocs(q11);
querySnapshot11.forEach((doc) => {
// doc.data() is never undefined for query doc snapshots
//console.log(doc.id, " => ", doc.data());
  cert.push(doc.data());
AddAllItemsToTable4(cert);
});

function timeFunction1() {
setTimeout(async function(){ 
  var q1 = query(collection(db, "JobConfig", "Master", "Cities"),where("State", "==", "Andhra Pradesh"));
var querySnapshot1 = await getDocs(q1);
querySnapshot1.forEach((doc) => {
  // doc.data() is never undefined for query doc snapshots
  //console.log(doc.id, " => ", doc.data());
    cert.push(doc.data());
  AddAllItemsToTable3(cert);
  const source = doc.metadata.fromCache ? "local cache" : "server";
  console.log("Data came from " + source);
}); 
 }, 6000);
}

  </script>

  </body>
</html>
