<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Master Panel</title>
 <!-- styles-->
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
 <link rel="stylesheet" type="text/css" href="Style/style.css">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
 <link href="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.css" rel="stylesheet">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



 <!--scripts>-->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" referrerpolicy="no-referrer"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
 <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
 <script type="module" src="Script3/FunctionalAreaScript.js"></script>
 <script type="text/javascript" src="jQuery.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
 <script src="src/fancyTable.js"></script>
 <script type="text/javascript" src="/public/pagesort.js"></script>
 <script src="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.js"></script>
 <script src="https://cdn.jsdelivr.net/n pm/jquery.fancytable/dist/fancyTable.min.js"></script>
 <script src="src/fancyTable.js"></script>

  </head>
  <body>
    <!-- code for the master page -->
    <div id="wrapper" class="toggled">
      <div id="sidebar-wrapper">
          <div class="logo">
              <img src="logoimage.png" class="logoimg" alt="">
          </div>

          <div class="vertical-menu">
              <a href="#home" >Dashboard</a>

              <div class="subnav-content">
                  <a href="Certification.html">Certification</a>
                  <a href="JobTypes.html">Job Types</a>
                  <a href="Qualification.html">Qualification</a>
                  <a class="active" href="FunctionalArea.html">Functional Area</a>
                  <a href="Cities.html">Cities</a>
                  <a href="Skills.html">Skills</a>
                  <a href="Specialization.html">Specialization</a>
                  <a href="PackageMaster.html">PackageMaster</a>
                  <a href="CouponMaster.html">Coupon Master</a>
                  <a href="EmployerMaster.html">Employer Master</a>
                  <a href="CandidateMaster.html">Candidate Master</a>
                  <a href="SubscriptionMaster.html">Subscription Master</a>
                  <a href="ChangePassword.html">Change Password</a>
              </div>
              <div class="subnav-content">
                  <a href="#home">Reports</a>
              </div>
              <a href="#contact">Contact</a>
          </div>
          
      </div>
 
  <!-- functionalarea-->
  <div id="functionalarea" class="tabcontent">
    <a href="#menu-toggle4"   class="tgl-btn" id="menu-toggle4"><i style="color: white; border-top-left-radius:0px" class="fa fa-bars"></i></a>
    <button type="button" class="btn add-btn" onclick="Logoutfunc()"><i class="fa fa-power-off"></i></button>
      
    <div id="page-content-wrapper">
        <div class="m-1">
          <button type="button" class="btn add-btn" onclick="openForm()"><i class="fa fa-plus"></i> Add New</button>
        </div>
        <h1 style="color: black;">Functional Area</h1>
      <table id="myTableFunc" class="table myTableFunc">
      <thead>
        <tr>
          <th>Category</th>
          <!-- <th>CId</th> -->
          <th>SubCategory</th>
          <!-- <th>SId</th> -->
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="tbody4">
      </tbody>
    </table>
    </div>
    <dialog class="ui-front" id="favDialog" style="position:absolute; bottom: auto; width: fit-content; height: fit-content;">
      <form method="dialog">
        <div> 
          <label>Enter FunctionalArea Category:</label>
          <input class="input-box-330" type="text" name="categoryName" id="categoryName" required>
        </div> 
        <div>
          <label>Enter FunctionalArea SubCategory:</label>
          <input class="input-box-330" type="text" name="subCategoryName" id="subCategoryName" required>
        </div> 
        <input type="hidden" id="id" name="id"> 
        <div style="align-items: right;">
          <button type="submit" id="subbut" class="sub-btn" onclick="myFunctionFunctAre()" >Submit</button>
          <input id="cancelButton" style="background-color: white; color:black; margin-left: 10px;" class="sub-btn" onClick="closeForm()" type="button" value="Cancel">
        </div>
      </form>    
      </dialog>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery.fancytable/dist/fancyTable.min.js"></script> 
 <style>

.ui-menu .ui-menu-item a {
  font-size: 12px;
}
.ui-autocomplete {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1510 !important;
  float: left;
  display: none;
  min-width: 160px;
  width: 160px;
  padding: 4px 0;
  margin: 2px 0 0 0;
  list-style: none;
  background-color: #ffffff;
  border-color: #ccc;
  border-color: rgba(0, 0, 0, 0.2);
  border-style: solid;
  border-width: 1px;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
  -webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
  -moz-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
  -webkit-background-clip: padding-box;
  -moz-background-clip: padding;
  background-clip: padding-box;
  *border-right-width: 2px;
  *border-bottom-width: 2px;
}
.ui-menu-item > a.ui-corner-all {
    display: block;
    padding: 3px 15px;
    clear: both;
    font-weight: normal;
    line-height: 18px;
    color: #555555;
    white-space: nowrap;
    text-decoration: none;
}
.ui-state-hover, .ui-state-active {
      color: #ffffff;
      text-decoration: none;
      background-color: #0088cc;
      border-radius: 0px;
      -webkit-border-radius: 0px;
      -moz-border-radius: 0px;
      background-image: none;
}
  </style>
<script>
$( window ).on("load", function() {
    setTimeout(async function(){ 
  $(".myTableFunc").fancyTable({ 	
    globalSearch: true,
    sortable: true,
    pagination: true, 			
    perPage:5, 				
  });
}, 1000);
});
$('#MasterOpen').on('click', function() {
  $("#MasterSubMenu").show();
});
$('#DashboardOpen').on('click', function() {
  $("#MasterSubMenu").hide();
});
$('#ReportsOpen').on('click', function() {
  $("#MasterSubMenu").hide();
});
function openForm() {
  document.querySelector("#favDialog").showModal();
}

function closeForm() {
  document.querySelector("#favDialog").close();
  location.reload(true);
}

document.querySelector("#favDialog").addEventListener('cancel', function(e) {
	e.preventDefault();
});
</script>


  
  <script type="module">
  // import EditorJS from '@editorjs/editorjs';
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-analytics.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
    import { doc, deleteDoc,setDoc, getDoc, getDocs, collection, addDoc, query, orderBy, limit, updateDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyAADC0o-0zy-R8WWzSY4hq_ckhLzNv6CHM",
  authDomain: "hobyjoby-8b9ca.firebaseapp.com",
  projectId: "hobyjoby-8b9ca",
  storageBucket: "hobyjoby-8b9ca.appspot.com",
  messagingSenderId: "755782612092",
  appId: "1:755782612092:web:98ed2fb25735eb435985f9",
  measurementId: "G-L23JY97GH8"
};
    
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      

      var dateTime = new Date().toLocaleString().replace(',','');

      const categories = [];

      const snapshot =  await getDocs(collection(db, "JobConfig", "Master", "FunctionalArea"));
      snapshot.forEach((doc) => {
        // doc.data() is never undefined for query doc snapshots
        //console.log(doc.id, " => ", doc.data());
        console.log(doc.data().Category);
        if(!categories.includes(doc.data().Category)){
          categories.push(doc.data().Category)
        }
        // console.log("Data came from " + source);
      });

  $("input#categoryName").autocomplete({
    source: categories,    
    appendTo: "#favDialog"
  });
 //FunctionalArea
 window.myFunctionFunctAre = async function() {

    var table = document.getElementById("myTableFunc");
    var categoryName = document.getElementById("categoryName").value;
    var subCategoryName = document.getElementById("subCategoryName").value;
    var dbID = document.getElementById("id").value;
    var a=table.rows.length;
    var b=table.rows.length;
    var ao;
    const snapshot =  await getDocs(collection(db, "JobConfig", "Master", "FunctionalArea"));
    if(!snapshot.empty)
    {
      const ids = snapshot.docs.map(doc => (!isNaN(parseInt((doc.id) ? doc.id : '0'))) ? parseInt((doc.id) ? doc.id : '0') : 0)
      const max = Math.max(...ids);
      ao = parseInt(max) + 1;
    }
    if(ao == null)
    {
      ao =1;
    }
    let text;
  
    if (categoryName == null || categoryName == "" || subCategoryName == null || subCategoryName == "") {
    text = "User cancelled the prompt.";
    } else {
      if(dbID == null || dbID == ""){
        await setDoc(doc(db, "JobConfig", "Master", "FunctionalArea",ao.toString()), {
                        CId: '1',
                        Category:categoryName.toString(),
                        SCId : ao.toString(),
                        SubCategory: subCategoryName.toString()
                    })
                    .then(()=> {  
                    setTimeout("location.reload(true);",120);
                    })     
                    .catch((error)=>{
                        console.log(error);
                    }); 
      }
      else{
        updateDoc(doc(db, "JobConfig", "Master", "FunctionalArea", dbID.toString()), {
                            CId: '1',
                            Category:categoryName.toString(),
                            SCId : dbID.toString(),
                            SubCategory: subCategoryName.toString()
                          })   
                          .then(()=> {  
                            setTimeout("location.reload(true);",120);
                          })     
                          .catch((error)=>{
                              console.log(error);
                          }); 
      }
    }
 }
  
 window.Logoutfunc = function(){
    if (confirm("Are you sure you want to log out?") == true) {
      window.location.replace("index.html");

    } else {
        window.location.reload();
    }
   
  }
                                                               
  </script>

  </body>
</html>
