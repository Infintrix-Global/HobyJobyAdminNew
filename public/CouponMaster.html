<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Master Panel</title>
 <!-- styles-->
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
 <link rel="stylesheet" type="text/css" href="Style/style.css">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
 <link href="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.css" rel="stylesheet">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



 <!--scripts>-->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" referrerpolicy="no-referrer"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
 <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
 <script type="module" src="Script3/CouponsScript.js"></script>
 <script type="text/javascript" src="jQuery.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
 <script src="src/fancyTable.js"></script>
 <script type="text/javascript" src="/public/pagesort.js"></script>
 <script src="https://unpkg.com/bootstrap-table@1.21.0/dist/bootstrap-table.min.js"></script>
 <script src="https://cdn.jsdelivr.net/n pm/jquery.fancytable/dist/fancyTable.min.js"></script>
 <script src="src/fancyTable.js"></script>

  </head>
  <body>
    <!-- code for the master page -->
    <div id="wrapper" class="toggled">
      <div id="sidebar-wrapper">
          <div class="logo">
              <img src="logoimage.png" class="logoimg" alt="">
          </div>

          <div class="vertical-menu">
              <a href="#home" >Dashboard</a>

              <div class="subnav-content">
                  <a href="Certification.html">Certification</a>
                  <a href="JobTypes.html">Job Types</a>
                  <a  href="Qualification.html">Qualification</a>
                  <a href="FunctionalArea.html">Functional Area</a>
                  <a href="Cities.html">Cities</a>
                  <a href="Skills.html">Skills</a>
                  <a href="Specialization.html">Specialization</a>
                  <a href="PackageMaster.html">PackageMaster</a>
                  <a class="active" href="CouponMaster.html">Coupon Master</a>
                  <a href="EmployerMaster.html">Employer Master</a>
                  <a href="CandidateMaster.html">Candidate Master</a>
                  <a href="SubscriptionMaster.html">Subscription Master</a>
                  <a href="ChangePassword.html">Change Password</a>
              </div>
              <div class="subnav-content">
                  <a href="#home">Reports</a>
              </div>
              <a href="#contact">Contact</a>
          </div>
          
      </div>

  <!-- jobtypes-->
  <div id="coupons" class="tabcontent">
    <a href="#menu-toggle1" class="tgl-btn" id="menu-toggle1"><i style="color: white; border-top-left-radius:0px" class="fa fa-bars"></i></a>
    <button type="button"  class="btn add-btn" onclick="Logoutfunc()"><i class="fa fa-power-off"></i></button>
    <div id="page-content-wrapper">
      <div class="m-1">
        <button style="float: right;margin-top: 60px; margin-bottom: 20px; color: white;" type="button" class="btn add-btn" onclick="openForm()"><i class="fa fa-plus"></i> Add New</button>
      </div>
      <div class="container-fluid">
        <h1 style="color: black; margin-bottom: 20px;">Coupons</h1>
        <table id="myTableCoupon" class="table myTableCoupon">
          <thead>
              <tr>
                  <th>Code</th>
                  <th>Description</th>
                  <th>Type</th>
                  <th>Value</th>
                  <th>Maximum Uses</th>
                  <th>Number of times Used</th>
                  <th>Expiry Date</th>
                  <th>Action</th>
              </tr>
          </thead>
          <tbody id="tbody2" >
          </tbody>
      </table>
          
      </div>
      <dialog id="favDialog" style="position:absolute; bottom: auto; width: fit-content; height: fit-content;">
      <form method="dialog">
        <div>
          <label>Enter Coupon Code:</label>
          <input class="input-box-330" type="text" name="couponCode" id="couponCode" required>
        </div>
        <div>
            <label>Enter Description:</label>
            <input class="input-box-330" type="text" name="couponDescription" id="couponDescription" required>
        </div>
        <div>
            <label>Enter Discount Type:</label>
            <select name="couponType" id="couponType" onchange="yesnoCheck(this);" style="width:190px; height: 30px;" required>
                <option value="0">Select from below:</option>
                <option value="1">Percentage</option>
                <option value="2">Fixed Amount</option>
            </select>
        </div>
        <div id="couponValueDiv" style="display: none;">
            <label id="disAmount" style="display: none;">Enter Discount Value:</label>
            <label id="disPercentage" style="display: none;">Enter Discount Percentage:</label>
            <input class="input-box-330"   type="number" name="couponValue" id="couponValue" required>
        </div>
        <div>
            <label>Enter Maximum Number of Uses:</label>
            <input class="input-box-330" type="number" name="couponMaximumUses" id="couponMaximumUses" required>
        </div>
        <div>
            <label>Select Expiry Date:</label>
            <input class="input-box-330 min-today" type="date" name="couponExpiryDate" id="couponExpiryDate" required>
        </div>
          <input type="hidden" id="id" name="id"> 
        <div style="align-items: right;">
          <button type="submit" id="subbut" class="sub-btn" onclick="myFunctionCoupon()" >Submit</button>
          <input id="cancelButton" style="background-color: white; color:black; margin-left: 10px;" class="sub-btn" onClick="closeForm()" type="button" value="Cancel">
        </div>
      </form>    
      </dialog>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery.fancytable/dist/fancyTable.min.js"></script> 
<script>
$( window ).on("load", function() {
    setTimeout(async function(){ 
    $(".myTableCoupon").fancyTable({ 	
        globalSearch: true,
        sortable: true,
        pagination: true, 			
        perPage:5, 	
        sortColumn: 2,		
    });
    }, 1000);
});
$('#MasterOpen').on('click', function() {
  $("#MasterSubMenu").show();
});
$('#DashboardOpen').on('click', function() {
  $("#MasterSubMenu").hide();
});
$('#ReportsOpen').on('click', function() {
  $("#MasterSubMenu").hide();
});
$(function(){
    $('[type="date"].min-today').prop('min', function(){
        return new Date().toJSON().split('T')[0];
    });
});

function yesnoCheck(that) {
      if (that.value == 1 || that.value == 2) {
        $('#couponValueDiv').show();
        if(that.value == 1)
        {
          $('#disPercentage').show();
        }
        if(that.value == 2){
          $('#disAmount').show();
        }
      } else {
        $('#couponValueDiv').hide();
      }
}

function openForm() {
  document.querySelector("#favDialog").showModal();
}

function closeForm() {
  document.querySelector("#favDialog").close();
  location.reload(true);
}

document.querySelector("#favDialog").addEventListener('cancel', function(e) {
	e.preventDefault();
});

</script>


  
  <script type="module">
    
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-analytics.js";
    import { getFirestore, Timestamp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
    import { doc, deleteDoc,setDoc, getDoc, getDocs, collection, addDoc, query, orderBy, limit, updateDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyAADC0o-0zy-R8WWzSY4hq_ckhLzNv6CHM",
  authDomain: "hobyjoby-8b9ca.firebaseapp.com",
  projectId: "hobyjoby-8b9ca",
  storageBucket: "hobyjoby-8b9ca.appspot.com",
  messagingSenderId: "755782612092",
  appId: "1:755782612092:web:98ed2fb25735eb435985f9",
  measurementId: "G-L23JY97GH8"
};
    
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      var dateTime = new Date().toLocaleString().replace(',','');

 
//Qualification

window.myFunctionCoupon = async function () {
    var table = document.getElementById("myTableCoupon");
    var couponCode = document.getElementById("couponCode").value;
    var couponDescription = document.getElementById("couponDescription").value;
    var couponType = document.getElementById("couponType").value;
    var couponValue = document.getElementById("couponValue").value;
    var couponMaximumUses = document.getElementById("couponMaximumUses").value;
    var couponExpiryDate = document.getElementById("couponExpiryDate").value;
    var dbID = document.getElementById("id").value;
  
    var a=table.rows.length;
    var b=table.rows.length;
    var ao;
    const snapshot =  await getDocs(collection(db, "JobConfig", "Master", "Coupons"));
    //const snapshot = await db.collection("JobConfig", "Master", "Qualifiactions").get()
    if(!snapshot.empty)
    {
      const ids = snapshot.docs.map(doc => (!isNaN(parseInt((doc.id) ? doc.id : '0'))) ? parseInt((doc.id) ? doc.id : '0') : 0)
      const max = Math.max(...ids);
      ao = parseInt(max) + 1;
    }
    if(ao == null)
    {
      ao =1;
    }
    let text;
    if ((couponCode == null || couponCode == "") || (couponDescription == null || couponDescription == "") || (couponType == null || couponType == "") || (couponValue == null || couponValue == "") || (couponMaximumUses == null || couponMaximumUses == "") || (couponExpiryDate == null || couponExpiryDate == "")) {
      text = "Please Enter the required value.";
    } else {
      if(dbID == null || dbID == ""){
       
          await setDoc(doc(db, "JobConfig", "Master", "Coupons",ao.toString()), {
                         CreatedAt :  dateTime.toString(),
                         CreatedBy : "1",
                         UpdatedAt :  dateTime.toString(),
                         UpdatedBy : "1",
                         id: ao.toString(),
                         Code: couponCode.toString(),
                         Description: couponDescription.toString(),
                         DiscountType: couponType,
                         DiscountValue: couponValue,
                         MaximumNOfUses: couponMaximumUses,
                         NumberOfTimesUsed : 0,
                         ExpiryDate: couponExpiryDate,
                        })
                         .then(()=> {  
                          setTimeout("location.reload(true);",120);
                        })     
                        .catch((error)=>{
                            console.log(error);
                        }); 
      }
      else{
        
           updateDoc(doc(db, "JobConfig", "Master", "Coupons", dbID.toString()), {
                         UpdatedAt :  dateTime.toString(),
                         UpdatedBy : "1",
                         id: dbID.toString(),
                         Code: couponCode.toString(),
                         Description: couponDescription.toString(),
                         DiscountType: couponType,
                         DiscountValue: couponValue,
                         MaximumNOfUses: couponMaximumUses,
                         NumberOfTimesUsed : 0,
                         ExpiryDate: couponExpiryDate,
                        })
                        .then(()=> {  
                          setTimeout("location.reload(true);",120);
                        })     
                        .catch((error)=>{
                            console.log(error);
                        }); 
      }

    }
}
  
window.Logoutfunc = function(){
    if (confirm("Are you sure you want to log out?") == true) {
      window.location.replace("index.html");

    } else {
        window.location.reload();
    }
   
  }
  
  
// window.texteditor = function(){
//   var holder = document.getElementById("example2");  
//     const editor = new EditorJS({
//     /**
//      * Id of Element that should contain Editor instance
//      */
//     holder: 'editorjs'
//   });
// }                                                               
  </script>


  </body>
</html>
